<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Reladomo Notification</title><link href="mithradoc.css" type="text/css" rel="stylesheet"><meta content="DocBook XSL Stylesheets V1.79.1" name="generator"><!-- (c) 2016 Copyright Goldman Sachs, Inc. --></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article"><div class="titlepage"><div><div><h2 class="title"><a name="N40003"></a>Reladomo Notification</h2></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="#N40010">1. What is "Reladomo Notification" and when do I need it?</a></span></dt><dt><span class="section"><a href="#N40034">2. When does Notification not help?</a></span></dt><dt><span class="section"><a href="#N4003D">3. How does Reladomo Notification work?</a></span></dt><dt><span class="section"><a href="#N4005E">4. What "communication mechanisms" are available?</a></span></dt><dt><span class="section"><a href="#N40067">5. What does the TCP-based Notification service involve?</a></span></dt><dd><dl><dt><span class="section"><a href="#N400B8">5.1. Single Notification</a></span></dt><dt><span class="section"><a href="#N400CB">5.2. Dual Notification</a></span></dt><dt><span class="section"><a href="#N400E1">5.3. Starting a Notification Server</a></span></dt></dl></dd><dt><span class="section"><a href="#N400F8">6. Anything else I should consider?</a></span></dt><dd><dl><dt><span class="section"><a href="#N40100">6.1. cacheTimeToLive</a></span></dt><dt><span class="section"><a href="#N4011C">6.2. Data integrity</a></span></dt></dl></dd></dl></div>

    

    <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40010"></a>1.&nbsp;What is "Reladomo Notification" and when do I need it?</h2></div></div></div>
        

        <p>
            When you have multiple JVMs connecting to a DB via Reladomo, you need to keep each JVM up-to-date with
            changes made by any of the other JVMs.
            Reladomo Notification is the primary mechanism for achieving this and keeping each JVMs Reladomo cache fresh.
        </p>
        <p>
            If you only have one JVM accessing a DB, you don&rsquo;t need Notification.
        </p>
        <p>
            You will need Notification in any of the following situations:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                    <p>Two or more JVMs accessing a single DB</p>
                </li><li class="listitem">
                    <p>An app server, plus a separate "batch updater" process</p>
                </li><li class="listitem">
                    <p>You have hot-hot or hot-warm redundant processes</p>
                </li></ul></div><p>
        </p>
    </div>

    <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40034"></a>2.&nbsp;When does Notification not help?</h2></div></div></div>
        

        <p>
            Notification doesn't help when one or more of your processes are not Reladomo JVM based,
            since the notifications are generated by Reladomo itself.
            There are strategies for managing this situation, but are less granular than what Reladomo offers,
            and you should consult your local Reladomo expert before implementing.
        </p>
    </div>

    <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N4003D"></a>3.&nbsp;How does Reladomo Notification work?</h2></div></div></div>
        

        <p>
            When DB data is changed by a Reladomo process, "notifications" of these changes are broadcast via some
            communication mechanism to all other Reladomo clients in your notification "realm".
        </p>

        <div class="figure"><a name="N40045"></a><p class="title"><b>Figure&nbsp;1.&nbsp;Notification Communication</b></p><div class="figure-contents">
            
            <div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="notificationCommunication.png" width="100%" alt="Notification Communication"></td></tr></table></div>
        </div></div><br class="figure-break">
    </div>

    <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N4005E"></a>4.&nbsp;What "communication mechanisms" are available?</h2></div></div></div>
        

        <p>
            The easiest to use (and is appropriate in 99.9% of use-cases) is TCP/IP.
            There also exists an RV implementation or you could implement your own mechanism
            (neither are recommended though, and not discussed in this document).
        </p>
    </div>

    <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40067"></a>5.&nbsp;What does the TCP-based Notification service involve?</h2></div></div></div>
        

        <p>
            Using classes provided with Reladomo, you can perform some simple configuration to enable Notification.
        </p>

        <div class="figure"><a name="N4006F"></a><p class="title"><b>Figure&nbsp;2.&nbsp;TCP Communication</b></p><div class="figure-contents">
            
            <div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="tcpCommunication.png" width="100%" alt="TCP Communication"></td></tr></table></div>
        </div></div><br class="figure-break">

        <p>
            The Notification Server is the central point that all JVMs will register with,
            and is responsible for forwarding notifications.
        </p>

        <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: Note:"><tr><td valign="top" align="center" rowspan="2" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Note:</th></tr><tr><td valign="top" align="left">
            
            <p>
                You will only have a second Notification server if you are using the "dual" communication mechanism.
            </p>
        </td></tr></table></div>

        <p>
            A Notification server requires only a small amount of memory and CPU to execute, and is highly reliable
            - the biggest threats to a Notification server are:
            admin error or a machine failure (including unplanned power-down).
            To protect against one of these, we recommend using "keep-alive" to monitor the process
            and re-start it if it should ever go down in your Prod environment.
        </p>

        <p>
            There are two varieties of TCP notifications: single notification and dual notification,
            and both leverage TCP/IP sockets.
            In practice, TCP communication is occasionally unreliable for brief periods,
            so Reladomo TCP notification supports re-tries to help ensure no data is lost:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                    <p>
                        If a JVM loses its connection to a Notification server,
                        it will periodically try to re-establish until it a connection is successfully made.
                    </p>
                </li><li class="listitem">
                    <p>
                        If a Notification server loses a connection to a client, it will try to re-connect for a period,
                        and if unsuccessful, will drop the client from its broadcast list.
                        A client can re-join a server at any time, even if it was dropped from its broadcast list.
                    </p>
                </li></ul></div><p>
        </p>

        <p>
            There are two varieties of TCP-based communication mechanisms:
            single notification (good for most use-cases)
            and dual notification (used when extreme redundancy and a low tolerance for stale data is demanded),
            both are discussed below.
        </p>

        <p>
            In either situation, you will need to ensure your ConnectionManager is configured
            to return an appropriate DB identifier.
        </p>

        <div class="example"><a name="N400AE"></a><p class="title"><b>Example&nbsp;1.&nbsp;Reladomo ConnectionManager getDatabaseIdentifier example implementation</b></p><div class="example-contents">
            
            <pre class="programlisting">
<strong xmlns:xslthl="http://xslthl.sf.net" class="hl-keyword"><span style="color: #000080">public</span></strong> String getDatabaseIdentifier() {
    <strong class="hl-keyword"><span style="color: #000080">return</span></strong> serverName + <strong class="hl-string"><span style="color: green">":"</span></strong> + schema;  <em style="color: gray" class="hl-comment">// must not return null</em>
}
</pre>
        </div></div><br class="example-break">

        <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="N400B8"></a>5.1.&nbsp;Single Notification</h3></div></div></div>
            

            <p>
                This type leverages a single Notification server, and is very easy to configure
                in each of your JVM processes.
                At some point in your applications Reladomo instance initialization, add the following lines:
            </p>

            <div class="example"><a name="N400C0"></a><p class="title"><b>Example&nbsp;2.&nbsp;Reladomo single TCP initialization fragment</b></p><div class="example-contents">
                
                <pre class="programlisting">
MithraManagerProvider.getMithraManager().setNotificationEventManager(
        <strong class="hl-keyword"><span style="color: #000080">new</span></strong> MithraNotificationEventManagerImpl(
                <strong class="hl-keyword"><span style="color: #000080">new</span></strong> TcpMessagingAdapterFactory(host, port)));
</pre>
            </div></div><br class="example-break">
        </div>

        <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="N400CB"></a>5.2.&nbsp;Dual Notification</h3></div></div></div>
            

            <p>
                This type leverages two Notification servers, and is very easy to configure
                in each of your JVM processes.
                At some point in your applications Reladomo instance initialization, add the following lines:
            </p>

            <div class="example"><a name="N400D3"></a><p class="title"><b>Example&nbsp;3.&nbsp;Reladomo dual TCP initialization fragment</b></p><div class="example-contents">
                
                <pre class="programlisting">
MithraManagerProvider.getMithraManager().setNotificationEventManager(
        <strong class="hl-keyword"><span style="color: #000080">new</span></strong> MithraNotificationEventManagerImpl(
                <strong class="hl-keyword"><span style="color: #000080">new</span></strong> TcpDualMessagingAdapterFactory(host1, port1, host2, port2)));
</pre>
            </div></div><br class="example-break">

            <p>
                With this configuration, notification messages are duplicated using redundant communication clients
                to redundant Notification servers.
            </p>
        </div>

        <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="N400E1"></a>5.3.&nbsp;Starting a Notification Server</h3></div></div></div>
            

            <p>
                Reladomo ships with all the necessary libraries to launch a Notification server,
                so starting a new instance is very easy:
            </p>

            <div class="example"><a name="N400E9"></a><p class="title"><b>Example&nbsp;4.&nbsp;Command line to launch a Notification Server</b></p><div class="example-contents">
                
                <pre class="programlisting">
java -classpath &lt;all the required jars&gt; -Dport=&lt;port number&gt;
        com.gs.fw.common.mithra.notification.server.NotificationServer
</pre>
            </div></div><br class="example-break">

            <p>
                If you are using dual-notification, you will need to do this twice,
                preferably on two different physical machines (for better robustness).
            </p>
        </div>
    </div>

    <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N400F8"></a>6.&nbsp;Anything else I should consider?</h2></div></div></div>
        

        <p>
            Yes.
        </p>

        <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="N40100"></a>6.1.&nbsp;cacheTimeToLive</h3></div></div></div>
            

            <p>
                We strongly recommend setting a <code class="code">cacheTimeToLive</code> value of 5 minutes (a.k.a. 300,000 ms)
                in your Reladomo runtime-XML configurations for all the <code class="code">partialCache</code> types.  E.g.:
            </p>

            <div class="example"><a name="N4010E"></a><p class="title"><b>Example&nbsp;5.&nbsp;Reladomo Runtime XML file cache configuration fragment</b></p><div class="example-contents">
                
                <pre class="programlisting">
<strong style="color: navy" class="hl-tag">&lt;MithraObjectConfiguration</strong> <span style="color: blue" class="hl-attribute">className</span>=<span style="color: green" class="hl-value">"com.gs.dept.app.domain.Order"</span> <span style="color: blue" class="hl-attribute">cacheType</span>=<span style="color: green" class="hl-value">"partial"</span> <span style="color: blue" class="hl-attribute">cacheTimeToLive</span>=<span style="color: green" class="hl-value">"300000"</span><strong style="color: navy" class="hl-tag"> /&gt;</strong>
</pre>
            </div></div><br class="example-break">

            <p>
                Should connectivity be lost to a Notification server, but the DB connection is still good,
                JVM processes can continue to work, but are at a small risk of having stale data,
                hence a time-out for cached data helps maintain data freshness whilst
                also helping to minimize peak memory usage.
            </p>
        </div>

        <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="N4011C"></a>6.2.&nbsp;Data integrity</h3></div></div></div>
            

            <p>
                If connectivity to a Notification server is lost, but the DB connection is still good,
                JVM processes can continue to work, but are at a small risk of having stale data.
                You can minimize this by setting the <code class="code">cacheTimeToLive</code> value as shown above.
                Also note that any transactional data being updated will be protected due to a
                combination of the transaction enrolling data rows being modified and optimistic locking.
            </p>
        </div>
    </div>

</div></body></html>