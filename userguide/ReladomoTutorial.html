<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Reladomo Tutorial</title><link href="mithradoc.css" type="text/css" rel="stylesheet"><meta content="DocBook XSL Stylesheets V1.79.1" name="generator"><!-- (c) 2016 Copyright Goldman Sachs, Inc. --></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article"><div class="titlepage"><div><div><h2 class="title"><a name="N40003"></a>Reladomo Tutorial</h2></div><div><div class="author"><h3 class="author"></h3></div></div><div><p class="pubdate">July 11, 2006</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="#N40014">1. How Do I Start a Reladomo Project?</a></span></dt><dt><span class="sect1"><a href="#N40045">2. Create The Reladomo Object XML Files</a></span></dt><dt><span class="sect1"><a href="#N40140">3. Create the Reladomo class list</a></span></dt><dt><span class="sect1"><a href="#N40154">4. Create the Reladomo Connection Manager</a></span></dt><dt><span class="sect1"><a href="#N40168">5. Create the Reladomo Runtime Configuration file</a></span></dt><dt><span class="sect1"><a href="#N40196">6. Initialization and startup</a></span></dt><dt><span class="sect1"><a href="#N401A9">7. Transaction Management</a></span></dt><dt><span class="sect1"><a href="#N4020C">8. Build your project</a></span></dt></dl></div>
    

    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40014"></a>1.&nbsp;How Do I Start a Reladomo Project?</h2></div></div></div>
        
        <p>
            This tutorial demonstrates the necessary steps to get your Reladomo project started. Since this example is
            for illustration purposes, we will keep it as simple as possible. Other examples will be provided to
            illustrate more advanced features of Reladomo.
        </p>
        <p>
            Let's assume that we want to create an application that can manipulate orders. An order contains information
            about its creation date, the user which created the order, and a description of the order. An order has a
            collection of items. An item has price information, quantity and the product specific information
            (product code, and product description).
        </p>
        <p>After the analysis process we came up with the domain model shown in<a class="xref" href="#domainmodel.fig" title="Figure&nbsp;1.&nbsp;Domain Model">Figure&nbsp;1, &ldquo;Domain Model&rdquo;</a>:
        </p>

        <div class="figure"><a name="domainmodel.fig"></a><p class="title"><b>Figure&nbsp;1.&nbsp;Domain Model</b></p><div class="figure-contents">
            
            <div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="figure1.gif" width="100%" alt="Domain Model"></td></tr></table></div>
        </div></div><br class="figure-break">

        <p>
            For this example, our database will contain three tables: ORDERS, ORDER_ITEM, and PROD_INFO.
        </p>
        <p>
            The first thing we need to do is create the Reladomo Object XML files that will map the Reladomo objects with
            the corresponding database table.
        </p>
    </div>

    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40045"></a>2.&nbsp;Create The Reladomo Object XML Files</h2></div></div></div>
        
        <p>
            Reladomo maps database tables with Java objects. These Java objects are generated by Reladomo using a set of
            configuration and Reladomo Object XML (mapping) files provided by the user.
        </p>
        <p>
            It is required to create one XML file for every Reladomo object. The Reladomo Object XML file is the metadata
            definition of the Reladomo object. The Reladomo Object XML defines:
        </p>
        <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                <p>
                    <span class="bold"><strong>objectType</strong></span>
                    - Specifies if the object is read-only or transactional.
                </p>
            </li><li class="listitem">
                <p>
                    <span class="bold"><strong>packageName</strong></span>
                    - The package to which the generated Reladomo classes belong to.
                </p>
            </li><li class="listitem">
                <p>
                    <span class="bold"><strong>className</strong></span>
                    - The name of the Reladomo object class. This class name will be used as
                    the base name for the generated classes.
                </p>
            </li><li class="listitem">
                <p>
                    <span class="bold"><strong>tableName</strong></span>
                    - Name of the database table to which the Reladomo object is mapped to.
                </p>
            </li><li class="listitem">
                <p>List of object attributes. For each attribute the meta-data will define:</p>
                <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: 1; "><li class="listitem" style="list-style-type: 1">
                        <p>
                            <span class="bold"><strong>name</strong></span>
                            - Name of the attribute.
                        </p>
                    </li><li class="listitem" style="list-style-type: 1">
                        <p>
                            <span class="bold"><strong>javaType</strong></span>
                            - The Java type of the attribute. Using the Java type specified and the
                            attribute name, the generator will create the attribute's getters and setters. Valid
                            JavaTypes are primitive types, String, Date, Timestamp, and byte[] (for blobs).
                        </p>
                    </li><li class="listitem" style="list-style-type: 1">
                        <p>
                            <span class="bold"><strong>columnName</strong></span>
                            - The name of the column in the mapped database table.
                        </p>
                    </li><li class="listitem" style="list-style-type: 1">
                        <p>
                            <span class="bold"><strong>primaryKey</strong></span>
                            - Indicates that the attribute is part of the primary key. Every Reladomo object
                            must contains at least one primaryKey attribute.
                        </p>
                    </li><li class="listitem" style="list-style-type: 1">
                        <p>primaryKeyGeneratorStrategy - Valid only when primaryKey is set to "true". It indicates
                            the strategy used for automatic primary key generation. Valid values are: Max or
                            SimulatedSequence. Max strategy is more suitable for legacy systems.
                        </p>
                    </li><li class="listitem" style="list-style-type: 1">
                        <p><span class="bold"><strong>nullable</strong></span>- True if the column is nullable.
                        </p>
                    </li><li class="listitem" style="list-style-type: 1">
                        <p>
                            <span class="bold"><strong>readOnly</strong></span>
                            - Indicates that this attribute is read-only (cannot be modified).
                        </p>
                    </li></ul></div>
            </li><li class="listitem">
                <p>Relationships to another classes - Relationships link objects of various types</p>
            </li></ul></div>

        <p>
            Refer to the xml schema definition (mithraobject.xsd) for a detailed explanation of the components of
            the Reladomo Object XML file.
        </p>
        <p>
            For this example we need to create three Reladomo objects: Order, OrderItem, and ProductInfo.
        </p>
        <p>
            <span class="bold"><strong>Order.xml:</strong></span>
        </p>
        <pre class="programlisting"><strong xmlns:xslthl="http://xslthl.sf.net" style="color: navy" class="hl-tag">&lt;MithraObject</strong> <span style="color: blue" class="hl-attribute">objectType</span>=<span style="color: green" class="hl-value">"transactional"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;PackageName&gt;</strong>com.gs.fw.common.mithra.test.domain<strong style="color: navy" class="hl-tag">&lt;/PackageName&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;ClassName&gt;</strong>Order<strong style="color: navy" class="hl-tag">&lt;/ClassName&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;DefaultTable&gt;</strong>ORDERS<strong style="color: navy" class="hl-tag">&lt;/DefaultTable&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"orderId"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"long"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"ORDER_ID"</span>   <span style="color: blue" class="hl-attribute">primaryKey</span>=<span style="color: green" class="hl-value">"true"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"orderDate"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"Timestamp"</span>   <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"ORDER_DATE"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"userId"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"int"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"USER_ID"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"description"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"String"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"DESCRIPTION"</span> <span style="color: blue" class="hl-attribute">maxLength</span>=<span style="color: green" class="hl-value">"50"</span> <span style="color: blue" class="hl-attribute">truncate</span>=<span style="color: green" class="hl-value">"true"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Relationship</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"items"</span> <span style="color: blue" class="hl-attribute">relatedObject</span>=<span style="color: green" class="hl-value">"OrderItem"</span> <span style="color: blue" class="hl-attribute">cardinality</span>=<span style="color: green" class="hl-value">"one-to-many"</span><strong style="color: navy" class="hl-tag"> &gt;</strong>
         OrderItem.orderId = this.orderId
    <strong style="color: navy" class="hl-tag">&lt;/Relationship&gt;</strong>
<strong style="color: navy" class="hl-tag">&lt;/MithraObject&gt;</strong></pre>
        <p>
            <span class="bold"><strong>OrderItem.xml:</strong></span>
        </p>
        <pre class="programlisting"><strong style="color: navy" class="hl-tag">&lt;MithraObject</strong> <span style="color: blue" class="hl-attribute">objectType</span>=<span style="color: green" class="hl-value">"transactional"</span><strong style="color: navy" class="hl-tag">&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;PackageName&gt;</strong>com.gs.fw.common.mithra.test.domain<strong style="color: navy" class="hl-tag">&lt;/PackageName&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;ClassName&gt;</strong>OrderItem<strong style="color: navy" class="hl-tag">&lt;/ClassName&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;DefaultTable&gt;</strong>ORDER_ITEM<strong style="color: navy" class="hl-tag">&lt;/DefaultTable&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"itemId"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"long"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"ITEM_ID"</span> <span style="color: blue" class="hl-attribute">primaryKey</span>=<span style="color: green" class="hl-value">"true"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"orderId"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"long"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"ORDER_ID"</span> <span style="color: blue" class="hl-attribute">primaryKey</span>=<span style="color: green" class="hl-value">"true"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"productId"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"long"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"PROD_ID"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"quantity"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"int"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"QTY"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"itemPrice"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"double"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"ITEM_PRICE"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;Relationship</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"productInfo"</span> <span style="color: blue" class="hl-attribute">relatedObject</span>=<span style="color: green" class="hl-value">"ProductInfo"</span> <span style="color: blue" class="hl-attribute">cardinality</span>=<span style="color: green" class="hl-value">"one-to-one"</span><strong style="color: navy" class="hl-tag"> &gt;</strong>
         ProductInfo.productId = this.productId
    <strong style="color: navy" class="hl-tag">&lt;/Relationship&gt;</strong>
<strong style="color: navy" class="hl-tag">&lt;/MithraObject&gt;</strong></pre>
        <p>
            <span class="bold"><strong>ProductInfo.xml:</strong></span>
        </p>
        <pre class="programlisting"><strong style="color: navy" class="hl-tag">&lt;MithraObject</strong> <span style="color: blue" class="hl-attribute">objectType</span>=<span style="color: green" class="hl-value">"transactional"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;PackageName&gt;</strong>com.gs.fw.common.mithra.test.domain<strong style="color: navy" class="hl-tag">&lt;/PackageName&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;ClassName&gt;</strong>ProductInfo<strong style="color: navy" class="hl-tag">&lt;/ClassName&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;DefaultTable&gt;</strong>PROD_INFO<strong style="color: navy" class="hl-tag">&lt;/DefaultTable&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"productId"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"long"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"PROD_ID"</span> <span style="color: blue" class="hl-attribute">primaryKey</span>=<span style="color: green" class="hl-value">"true"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"productCode"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"String"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"PROD_CODE"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;Attribute</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"productDescription"</span> <span style="color: blue" class="hl-attribute">javaType</span>=<span style="color: green" class="hl-value">"double"</span> <span style="color: blue" class="hl-attribute">columnName</span>=<span style="color: green" class="hl-value">"PROD_DESC"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
<strong style="color: navy" class="hl-tag">&lt;/MithraObject&gt;</strong></pre>

        <p>
            <span class="bold"><strong>Reladomo Relationships</strong></span>
        </p>
        <p>The relationship tag defines how the Reladomo object is related to another Reladomo object.
            In our example, the Order object has a one-to-many relationship with OrderItem. In the database,
            these two tables are related by the ORDER_ID column. A relationship between Order and OrderItem
            can be defined like this:
        </p>

        <pre class="programlisting"><strong style="color: navy" class="hl-tag">&lt;Relationship</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"items"</span> <span style="color: blue" class="hl-attribute">relatedObject</span>=<span style="color: green" class="hl-value">"OrderItem"</span> <span style="color: blue" class="hl-attribute">cardinality</span>=<span style="color: green" class="hl-value">"one-to-many"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
    OrderItem.orderId = this.orderId
<strong style="color: navy" class="hl-tag">&lt;/Relationship&gt;</strong></pre>
        <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                <p>
                    <span class="bold"><strong>name</strong></span>
                    - This name is used by Reladomo to generate convenience methods
                    to retrieve related objects.
                </p>
            </li><li class="listitem">
                <p>
                    <span class="bold"><strong>relatedObject</strong></span>
                    - This attribute specifies the related object's name
                </p>
            </li><li class="listitem">
                <p>
                    <span class="bold"><strong>cardinality</strong></span>
                    - This attribute specifies the type of relationship between
                    the objects. It could be on of "one-to-one", "one-to-many",
                    "many-to-many"
                </p>
            </li><li class="listitem">
                <p>
                    <span class="bold"><strong>relationship expression</strong></span>
                    - An expression that indicates a set of rules
                    that an one object needs to satisfy to
                    become related to another object.
                </p>
            </li></ul></div>

        <p>This relationship definition instructs the Reladomo code generator to create a relationship attribute in
            the Finder object (Finders are generated classes used to access Reladomo object attributes and to create
            Operation objects, more on Finders, Attributes, and Operations later). In addition, a method to access the
            related objects is generated in the Reladomo object. For example, in this case a getItems() method is
            generated.
            This method will return all the OrderItem objects for an Order based on the relationship
            expression (OrderItem.orderId = this.orderId).
        </p>

        <p>Sometimes is necessary to traverse the relationship in the opposite direction, for example, it will be
            useful to know the details of an Order based on an OrderItem. You can add a relationship tag in the
            OrderItem.xml that defines the relationship from OrderItem to Order. This will cause the generation of
            similar methods and relationship attributes in the OrderItem generated classes. Another way to do this is
            to use the reverseRelationshipName attribute in the Relationship tag definition.
        </p>

        <pre class="programlisting"><strong style="color: navy" class="hl-tag">&lt;Relationship</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"items"</span> <span style="color: blue" class="hl-attribute">relatedObject</span>=<span style="color: green" class="hl-value">"OrderItem"</span> <span style="color: blue" class="hl-attribute">cardinality</span>=<span style="color: green" class="hl-value">"one-to-many"</span> <span style="color: blue" class="hl-attribute">reverseRelationshipName</span>=<span style="color: green" class="hl-value">"order"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
      OrderItem.orderId = this.orderId
<strong style="color: navy" class="hl-tag">&lt;/Relationship&gt;</strong></pre>

        <p>
            By using the reverseRelationship attribute, the Relationship needs to be defined only once
            (in this case in Order.xml). Reladomo will take care of generating the necessary relationship attributes
            and methods on both related set of classes.
        </p>
        <p>
            Will be discussing in details how relation works and how to build more complex relationships in
            subsequent documents.
        </p>

        <p>
            Once the Reladomo Object XML files are created, we need to create the Reladomo class list.
        </p>

    </div>
    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40140"></a>3.&nbsp;Create the Reladomo class list</h2></div></div></div>
        

        <p>
            The Reladomo class list is an xml file used during the generation of the Reladomo classes. The file lists the
            name
            of the Reladomo objects that need to be generated.
        </p>
        <p>
            <span class="bold"><strong>MithraClassList.xml:</strong></span>
        </p>

        <pre class="programlisting"><strong style="color: navy" class="hl-tag">&lt;Mithra&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;MithraObjectResource</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"Order"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;MithraObjectResource</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"OrderItem"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;MithraObjectResource</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"ProductInfo"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
<strong style="color: navy" class="hl-tag">&lt;/Mithra&gt;</strong></pre>

    </div>
    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40154"></a>4.&nbsp;Create the Reladomo Connection Manager</h2></div></div></div>
        
        <p>
            The Reladomo Connection Manager is an object that Reladomo will use during runtime to obtain a database
            connection.
        </p>

        <p>
            <span class="bold"><strong>MithraTestAppConnectionManager.java:</strong></span>
        </p>

        <pre class="programlisting"><strong class="hl-keyword"><span style="color: #000080">import</span></strong> com.gs.fw.common.mithra.connectionmanager.XAConnectionManager;
<strong class="hl-keyword"><span style="color: #000080">import</span></strong> com.gs.fw.common.mithra.connectionmanager.SourcelessConnectionManager;
<strong class="hl-keyword"><span style="color: #000080">import</span></strong> com.gs.fw.common.mithra.databasetype.DatabaseType;
<strong class="hl-keyword"><span style="color: #000080">import</span></strong> com.gs.fw.common.mithra.databasetype.SybaseDatabaseType;
<strong class="hl-keyword"><span style="color: #000080">import</span></strong> java.util.TimeZone;
<strong class="hl-keyword"><span style="color: #000080">import</span></strong> java.sql.Connection;

<strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">class</span></strong> MyProjConnectionManager <strong class="hl-keyword"><span style="color: #000080">implements</span></strong> SourcelessConnectionManager
{
    <strong class="hl-keyword"><span style="color: #000080">protected</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> MyProjConnectionManager instance;
    <strong class="hl-keyword"><span style="color: #000080">protected</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> <strong class="hl-keyword"><span style="color: #000080">final</span></strong> String MAX_POOL_SIZE_KEY = <strong class="hl-string"><span style="color: green">"maxPoolSize"</span></strong>;
    <strong class="hl-keyword"><span style="color: #000080">protected</span></strong> <strong class="hl-keyword"><span style="color: #000080">final</span></strong> <strong class="hl-keyword"><span style="color: #000080">int</span></strong> DEFAULT_MAX_WAIT = <span style="color:blue" class="hl-number">500</span>;
    <strong class="hl-keyword"><span style="color: #000080">protected</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> <strong class="hl-keyword"><span style="color: #000080">final</span></strong> <strong class="hl-keyword"><span style="color: #000080">int</span></strong> DEFAULT_POOL_SIZE = <span style="color:blue" class="hl-number">10</span>;
    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> <strong class="hl-keyword"><span style="color: #000080">final</span></strong> TimeZone NEW_YORK_TIMEZONE = TimeZone.getTimeZone(<strong class="hl-string"><span style="color: green">"America/New_York"</span></strong>);
    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> <strong class="hl-keyword"><span style="color: #000080">final</span></strong> String driverClassname = <strong class="hl-string"><span style="color: green">"..."</span></strong>;
    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> <strong class="hl-keyword"><span style="color: #000080">final</span></strong> String serverName = <strong class="hl-string"><span style="color: green">"MYSERVER"</span></strong>;
    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> <strong class="hl-keyword"><span style="color: #000080">final</span></strong> String resourceName = <strong class="hl-string"><span style="color: green">"MYPROJ"</span></strong>;

    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> XAConnectionManager xaConnectionManager;

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> <strong class="hl-keyword"><span style="color: #000080">synchronized</span></strong> MyProjConnectionManager getInstance()
    {
        <strong class="hl-keyword"><span style="color: #000080">if</span></strong> (instance == null)
        {
            instance = <strong class="hl-keyword"><span style="color: #000080">new</span></strong> MyProjConnectionManager();
        }
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> instance;
    }
    <strong class="hl-keyword"><span style="color: #000080">protected</span></strong> MyProjConnectionManager()
    {
        <strong class="hl-keyword"><span style="color: #000080">this</span></strong>.createConnectionManager();
    }

    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> XAConnectionManager createConnectionManager()
    {
        xaConnectionManager = <strong class="hl-keyword"><span style="color: #000080">new</span></strong> XAConnectionManager();
        xaConnectionManager.setDriverClassName(driverClassname);
        xaConnectionManager.setMaxWait(DEFAULT_MAX_WAIT);
        xaConnectionManager.setLdapName(serverName);
        xaConnectionManager.setDefaultSchemaName(resourceName);
        xaConnectionManager.setJdbcUser(<strong class="hl-string"><span style="color: green">"sa"</span></strong>);
        xaConnectionManager.setJdbcPassword(<strong class="hl-string"><span style="color: green">""</span></strong>);
        xaConnectionManager.setPoolName(<strong class="hl-string"><span style="color: green">"myproj connection pool"</span></strong>);
        xaConnectionManager.setInitialSize(<span style="color:blue" class="hl-number">1</span>);
        xaConnectionManager.setPoolSize(DEFAULT_POOL_SIZE);
        xaConnectionManager.setUseStatementPooling(true); <em style="color: gray" class="hl-comment">// Only good for DB2</em>
        xaConnectionManager.initialisePool();
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> xaConnectionManager;
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> Connection getConnection()
    {
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> xaConnectionManager.getConnection();
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> DatabaseType getDatabaseType()
    {
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> SybaseDatabaseType.getInstance();
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> TimeZone getDatabaseTimeZone()
    {
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> NEW_YORK_TIMEZONE;
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> BulkLoader createBulkLoader() <strong class="hl-keyword"><span style="color: #000080">throws</span></strong> BulkLoaderException
    {
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> <strong class="hl-keyword"><span style="color: #000080">this</span></strong>.getDatabaseType().createBulkLoader(
                    <strong class="hl-string"><span style="color: green">"sa"</span></strong>,
                    <strong class="hl-string"><span style="color: green">""</span></strong>,
                    <strong class="hl-keyword"><span style="color: #000080">this</span></strong>.xaConnectionManager.getHostName(),
                    <strong class="hl-keyword"><span style="color: #000080">this</span></strong>.xaConnectionManager.getPort());
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> String getDatabaseIdentifier()
    {
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> xaConnectionManager.getServerName()+<strong class="hl-string"><span style="color: green">":"</span></strong>+xaConnectionManager.getResourceName();
    }
}</pre>

    </div>
    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40168"></a>5.&nbsp;Create the Reladomo Runtime Configuration file</h2></div></div></div>
        
        <p>
            The Reladomo configuration file is an xml file used during the initialization of the Reladomo service.
            The Reladomo configuration xml contains lists of Reladomo Connection Manager and its associated Reladomo object
            configuration. The Reladomo object configuration specifies the fully qualified Reladomo object class and the
            caching strategy that Reladomo will use for that specific object.
        </p>

        <p>Reladomo supports two types of caching strategies:</p>
        <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                <p>
                    <span class="bold"><strong>partial</strong></span>
                    - This strategy makes Reladomo holds references that
                    will be garbage collected if there is a memory crunch.
                </p>
            </li><li class="listitem">
                <p>
                    <span class="bold"><strong>full</strong></span>
                    - This caching mode makes Reladomo load all the objects
                    from database and keep them permanently in cache. All queries for these objects are returned from
                    cache and all updates are write-through.
                </p>
            </li></ul></div>

        <p>
            <span class="bold"><strong>MithraRuntimeConfig.xml:</strong></span>
        </p>
        <pre class="programlisting"><strong style="color: navy" class="hl-tag">&lt;MithraRuntime&gt;</strong>
   <strong style="color: navy" class="hl-tag">&lt;ConnectionManager</strong> <span style="color: blue" class="hl-attribute">className</span>=<span style="color: green" class="hl-value">"com.gs.fw.common.MithraTestAppConnectionManager "</span><strong style="color: navy" class="hl-tag">&gt;</strong>
           <strong style="color: navy" class="hl-tag">&lt;MithraObjectConfiguration</strong> <span style="color: blue" class="hl-attribute">className</span>=<span style="color: green" class="hl-value">"com.gs.fw.myProject.mithra.Order"</span> <span style="color: blue" class="hl-attribute">cacheType</span>=<span style="color: green" class="hl-value">"partial"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
           <strong style="color: navy" class="hl-tag">&lt;MithraObjectConfiguration</strong> <span style="color: blue" class="hl-attribute">className</span>=<span style="color: green" class="hl-value">"com.gs.fw.myProject.mithra.OrderItem "</span> <span style="color: blue" class="hl-attribute">cacheType</span>=<span style="color: green" class="hl-value">"partial"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
           <strong style="color: navy" class="hl-tag">&lt;MithraObjectConfiguration</strong> <span style="color: blue" class="hl-attribute">className</span>=<span style="color: green" class="hl-value">"com.gs.fw.myProject.mithra.ProductInfo "</span> <span style="color: blue" class="hl-attribute">cacheType</span>=<span style="color: green" class="hl-value">"partial"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;/ConnectionManager&gt;</strong>
<strong style="color: navy" class="hl-tag">&lt;/MithraRuntime&gt;</strong></pre>

    </div>
    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N40196"></a>6.&nbsp;Initialization and startup</h2></div></div></div>
        
        <p>
            The runtime initialization process includes setting the transaction timeout and loading the
            MithraRuntimeConfig xml file(s).
        </p>

        <p>
            <span class="emphasis"><em>MithraTestApp.java:</em></span>
        </p>
        <pre class="programlisting"><strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">class</span></strong> MithraTestApp
{
    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> Logger logger = LoggerFactory.createLogger(MithraTestApp.<strong class="hl-keyword"><span style="color: #000080">class</span></strong>.getName());

    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> <strong class="hl-keyword"><span style="color: #000080">int</span></strong> maxTransactionTimeout = <span style="color:blue" class="hl-number">120</span>;

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> Logger getLogger()
    {
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> logger;
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> setLogger(Logger logger)
    {
        <strong class="hl-keyword"><span style="color: #000080">this</span></strong>.logger = logger;
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> <strong class="hl-keyword"><span style="color: #000080">int</span></strong> getMaxTransactionTimeout()
    {
        <strong class="hl-keyword"><span style="color: #000080">return</span></strong> maxTransactionTimeout;
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> setMaxTransactionTimeout(<strong class="hl-keyword"><span style="color: #000080">int</span></strong> maxTransactionTimeout)
    {
        MithraTestApp.maxTransactionTimeout = maxTransactionTimeout;
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">static</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> main(String[] args)
    {
        MithraTestApp app = <strong class="hl-keyword"><span style="color: #000080">new</span></strong> MithraTestApp();
        <strong class="hl-keyword"><span style="color: #000080">try</span></strong>
        {
            app.initialiseMithra();
            app.loadMithraConfigurationXml(<strong class="hl-string"><span style="color: green">"MithraRuntimeConfig1.xml"</span></strong>);
            <em style="color: gray" class="hl-comment">// optionally load multiple config files:</em>
            app.loadMithraConfigurationXml(<strong class="hl-string"><span style="color: green">"MithraRuntimeConfig2.xml"</span></strong>);

            <em style="color: gray" class="hl-comment">//Do your thing!!</em>

        }
        <strong class="hl-keyword"><span style="color: #000080">catch</span></strong>(Exception e)
        {
            System.out.println(e);
        }

    }

    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> loadMithraConfigurationXml(String mithraXml)
            <strong class="hl-keyword"><span style="color: #000080">throws</span></strong> Exception
    {
        logger.info(<strong class="hl-string"><span style="color: green">"Mithra configuration XML is "</span></strong> + mithraXml);
        InputStream is = MithraTestApp.<strong class="hl-keyword"><span style="color: #000080">class</span></strong>.getClassLoader().getResourceAsStream(mithraXml);
        <strong class="hl-keyword"><span style="color: #000080">if</span></strong> (is == null) <strong class="hl-keyword"><span style="color: #000080">throw</span></strong> <strong class="hl-keyword"><span style="color: #000080">new</span></strong> Exception(<strong class="hl-string"><span style="color: green">"can't find file: "</span></strong> + mithraXml + <strong class="hl-string"><span style="color: green">" in classpath"</span></strong>);
        MithraManagerProvider.getMithraManager().readConfiguration(is);
        <strong class="hl-keyword"><span style="color: #000080">try</span></strong>
        {
            is.close();
        }
        <strong class="hl-keyword"><span style="color: #000080">catch</span></strong> (java.io.IOException e)
        {
            logger.error(<strong class="hl-string"><span style="color: green">"Unable to initialise Reladomo!"</span></strong>, e);
            <strong class="hl-keyword"><span style="color: #000080">throw</span></strong> <strong class="hl-keyword"><span style="color: #000080">new</span></strong> Exception(<strong class="hl-string"><span style="color: green">"Unable to initialise Reladomo!"</span></strong>, e);
        }
        logger.info(<strong class="hl-string"><span style="color: green">"Reladomo configuration XML "</span></strong> + mithraXml+<strong class="hl-string"><span style="color: green">" is now loaded."</span></strong>);
    }

    <strong class="hl-keyword"><span style="color: #000080">private</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> initialiseMithra() <strong class="hl-keyword"><span style="color: #000080">throws</span></strong> Exception
    {
        <strong class="hl-keyword"><span style="color: #000080">try</span></strong>
        {
            logger.info(<strong class="hl-string"><span style="color: green">"Transaction Timeout is "</span></strong> + <strong class="hl-keyword"><span style="color: #000080">this</span></strong>.getMaxTransactionTimeout());
            MithraManager mithraManager = MithraManagerProvider.getMithraManager();
            mithraManager.setTransactionTimeout(<strong class="hl-keyword"><span style="color: #000080">this</span></strong>.getMaxTransactionTimeout());
        }
        <strong class="hl-keyword"><span style="color: #000080">catch</span></strong> (Exception e)
        {
            logger.error(<strong class="hl-string"><span style="color: green">"Unable to initialise Reladomo!"</span></strong>, e);
            <strong class="hl-keyword"><span style="color: #000080">throw</span></strong> <strong class="hl-keyword"><span style="color: #000080">new</span></strong> Exception(<strong class="hl-string"><span style="color: green">"Unable to initialise Reladomo!"</span></strong>, e);
        }
        logger.info(<strong class="hl-string"><span style="color: green">"Reladomo has been initialised!"</span></strong>);
    }
}</pre>
    </div>

    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N401A9"></a>7.&nbsp;Transaction Management</h2></div></div></div>
        

        <p>
            Objects retrieved via a finder operations are "live" objects meaning that any calls to setter methods are
            immediately reflected in the database. For efficiency, a series of setters should be called without each
            call resulting in a trip to the database. Also, usually the requirement is for a set of changes to
            be applied to one or more objects atomically so that they are committed together or rollback together.
            For both of these scenarios, Reladomo transactional commands are used.
        </p>
        <p>
            There is a TransactionalCommand interface for which developers provide an implementation class. The key
            method of the interface is:
        </p>
        <pre class="programlisting"><strong class="hl-keyword"><span style="color: #000080">public</span></strong> Object executeTransaction(MithraTransaction tx) <strong class="hl-keyword"><span style="color: #000080">throws</span></strong> Throwable</pre>
        <p>
            Implementers provide a class which implements this method. Inside this method, the various setters,
            insert, and/or delete methods of Reladomo objects are invoked. The executeTransaction method forms the
            transactional boundary
            which begins when the method is entered and commits when the method returns. The changes made to the various
            Reladomo objects modified inside the executeTransaction method are committed atomically in a single
            transaction.
            To rollback all the changes at any point, an exception is thrown from this method.
        </p>
        <p>
            To have a transaction performed, an initialized instance of the class which implements the TransactionalCommand
            interface is passed to the executeTransactionalCommand method of the MithraManagerProvider via this call:
        </p>
        <pre class="programlisting">MithraManagerProvider.getMithraManager().executeTransactionalCommand(myTransactionalCommand);</pre>
        <p>
            The following example illustrate Reladomo transaction management. They are based on the Order processing
            objects used in earlier sections.
        </p>
        <p>
            <span class="bold"><strong>Example 1: Create a new order with 3 order items and corresponding product
                descriptions.
            </strong></span>
            This update will require the insert of new 1 Order object, 3 OrderItem objects, and 3 ProductDescription
            objects.

            The steps to perform inside the executeTransaction method would be:
        </p>
        <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                Create a new Order object and fill in the details via setter methods
            </li><li class="listitem">
                Create 3 new OrderItem objects and fill in the details vai setter methods
            </li><li class="listitem">
                Create 3 new ProductDescription objects and fill in the details via setter methods
            </li><li class="listitem">
                Associate each ProductDescription with their respective OrderItem objects via the
                OrderItem.setProductDescription(ProductDescription) method
            </li><li class="listitem">
                Assign the 3 OrderItem objects to the Order object by calling Order.getOrderItems.add(OrderItem)
                method
                (Note: Order.getOrderItems() returns a OrderItemList upon which the add(OrderItem) method is called to
                add the new OrderItem to the list.)
            </li><li class="listitem">
                Commit all the changes by calling cascadeInsert() on the Order object.
            </li></ul></div>
        <p>
            Since all the objects are related either directly or indirectly to the Order object, Reladomo will
            automatically insert all the new objects so it is unnecessary to call insert() on each of them. However, as an
            alternative, you could call insert() on each newly created object individually rather than the
            cascadeInsert() call. This might be easier depending on the situation.
        </p>
        <p>
            The following is what the code might look like:
        </p>
        <pre class="programlisting">
<strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">class</span></strong> CreateNewOrder <strong class="hl-keyword"><span style="color: #000080">implements</span></strong> TransactionalCommand
{
    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> addOrderItem(OrderItemDetails item;)
    {
        myOrderDetailsList.add(item);  <em style="color: gray" class="hl-comment">// Keep a list of</em>
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> setOrderDescription(String orderDescription)
    {
        <strong class="hl-keyword"><span style="color: #000080">this</span></strong>.orderDescription = orderDescription;
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> Object executeTransaction() <strong class="hl-keyword"><span style="color: #000080">throws</span></strong> Throwable
    {
        Order = <strong class="hl-keyword"><span style="color: #000080">new</span></strong> Order();
        order.setDescription(<strong class="hl-keyword"><span style="color: #000080">this</span></strong>.orderDescription)

        <strong class="hl-keyword"><span style="color: #000080">for</span></strong> (OrderItemDetails details : myOrderDetailsList)
        {
            OrderItem orderItem = <strong class="hl-keyword"><span style="color: #000080">new</span></strong> OrderItem();
            <em style="color: gray" class="hl-comment">// Set values on orderItem from details object</em>
            ....

            ProductInfo productInfo = <strong class="hl-keyword"><span style="color: #000080">new</span></strong> ProductInfo();
            <em style="color: gray" class="hl-comment">// Set values on productInfo from details object</em>
            ......

            <em style="color: gray" class="hl-comment">// Associate ProductInfo Object with OrderItem</em>
            orderItem.setProductInfo(productInfo);

            <em style="color: gray" class="hl-comment">// Associate OrderItem to Order</em>
            order.getOrderItems().add(OrderItem)
        }

        <em style="color: gray" class="hl-comment">//Insert all the objects</em>
        order.cascadeInsert();
    }
}</pre>
        <p>
            Example 1 illustrated what can be done when all the objects involved are new. When adding new objects
            that will be related to existing objects, the situation is much simpler. See example 2 below:
        </p>
        <p>
            <span class="bold"><strong>Example 2: Add a new OrderItem to an existing Order
            </strong></span>

            In this example, we are creating a new OrderItem object and associating it with an existing Order.

            The steps to perform inside the executeTransaction method would be:
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                    Create a new OrderItem object
                </li><li class="listitem">
                    Associate it with the existing Order via the setOrderID(int orderID) method where orderID is the
                    ID of the existing Order
                </li><li class="listitem">
                    Call OrderItem() on the new ContactDetail object
                </li></ul></div><p>
        </p>
        <p>
            NOTE: You do not have to retrieve the Order object if you already know the order ID to use. Simply
            assigning the value via the setter method on OrderItem is sufficient to establish the relationship
            such that the list returned by a subsequent call to Order.getOrderItems() would now include the
            newly created OrderItem.
        </p>

        <p>
            The following is what the code might look like:
        </p>
        <pre class="programlisting">
<strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">class</span></strong> UpdateExistingOrder <strong class="hl-keyword"><span style="color: #000080">implements</span></strong> TransactionalCommand
{
    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> addOrderItem(OrderItemDetails item;)
    {
        myOrderDetailsList.add(item);  <em style="color: gray" class="hl-comment">// Keep a list of or</em>
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> <strong class="hl-keyword"><span style="color: #000080">void</span></strong> setOrderID(<strong class="hl-keyword"><span style="color: #000080">long</span></strong> orderID)
    {
        <em style="color: gray" class="hl-comment">// Record the ID of order to be updated</em>
        <strong class="hl-keyword"><span style="color: #000080">this</span></strong>.orderID = orderID;
    }

    <strong class="hl-keyword"><span style="color: #000080">public</span></strong> Object executeTransaction() <strong class="hl-keyword"><span style="color: #000080">throws</span></strong> Throwable
    {
        <strong class="hl-keyword"><span style="color: #000080">for</span></strong> (OrderItemDetails details : myOrderDetailsList)
        {
            OrderItem orderItem = <strong class="hl-keyword"><span style="color: #000080">new</span></strong> OrderItem();
            <em style="color: gray" class="hl-comment">//Set values on orderItem from details object</em>
            ....

            ProductInfo productInfo = <strong class="hl-keyword"><span style="color: #000080">new</span></strong> ProductInfo();
            <em style="color: gray" class="hl-comment">//Set values on productInfo from details object</em>
            ......

            <em style="color: gray" class="hl-comment">//Associate ProductInfo Object with OrderItem</em>
            orderItem.setProductInfo(productInfo);

            <em style="color: gray" class="hl-comment">//Associate new OrderItem with existing Order</em>
            orderItem.setOrderID(<strong class="hl-keyword"><span style="color: #000080">this</span></strong>.orderID);

            <em style="color: gray" class="hl-comment">//Save the new OrderItem</em>
            orderItem.insert();
        }
    }
}</pre>
    </div>

    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N4020C"></a>8.&nbsp;Build your project</h2></div></div></div>
        

        <p>
            Add Ant targets in the build.xml to generate and compile the Reladomo classes. A template driven code
            generator will generate all the necessary classes for Reladomo's use and generate empty concrete classes that
            will be modified by users to implement business logic. The code generator is available as an Ant task
            definition
            that can be integrated in an Ant target to generate the Reladomo classes that are specific to your project.
        </p>

        <p>
            <span class="bold"><strong>build.xml:</strong></span>
        </p>
        <pre class="programlisting"><strong style="color: navy" class="hl-tag">&lt;project</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"myproj"</span> <span style="color: blue" class="hl-attribute">default</span>=<span style="color: green" class="hl-value">"compile-myproj"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;property</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"myproj.home"</span> <span style="color: blue" class="hl-attribute">location</span>=<span style="color: green" class="hl-value">&lt;your</span> <span style="color: blue" class="hl-attribute">project</span> <span style="color: blue" class="hl-attribute">home&gt;</span><strong style="color: navy" class="hl-tag"> /&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;property</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"myproj.source.dir"</span> <span style="color: blue" class="hl-attribute">location</span>=<span style="color: green" class="hl-value">"${myproj.home}/src"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;property</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"generated.src.dir"</span> <span style="color: blue" class="hl-attribute">location</span>=<span style="color: green" class="hl-value">"${myproj.home}/generatedsrc"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;property</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"myproj.classes.dir"</span> <span style="color: blue" class="hl-attribute">location</span>=<span style="color: green" class="hl-value">"${myproj.home}/classes"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;property</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"myproj.lib.dir"</span> <span style="color: blue" class="hl-attribute">location</span>=<span style="color: green" class="hl-value">"${myproj.home}/lib"</span><strong style="color: navy" class="hl-tag"> /&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;path</strong> <span style="color: blue" class="hl-attribute">id</span>=<span style="color: green" class="hl-value">"myproj.compile.classpath"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;fileset</strong> <span style="color: blue" class="hl-attribute">dir</span>=<span style="color: green" class="hl-value">"${myproj.lib.dir}"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
              <strong style="color: navy" class="hl-tag">&lt;include</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"*.jar"</span><strong style="color: navy" class="hl-tag"> /&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;/fileset&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;/path&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;target</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"init-myproj"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;mkdir</strong> <span style="color: blue" class="hl-attribute">dir</span>=<span style="color: green" class="hl-value">"${myproj.classes.dir}"</span><strong style="color: navy" class="hl-tag"> /&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;mkdir</strong> <span style="color: blue" class="hl-attribute">dir</span>=<span style="color: green" class="hl-value">"${generated.src.dir}"</span><strong style="color: navy" class="hl-tag"> /&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;/target&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;target</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"clean-myproj"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;delete</strong> <span style="color: blue" class="hl-attribute">quiet</span>=<span style="color: green" class="hl-value">"true"</span> <span style="color: blue" class="hl-attribute">dir</span>=<span style="color: green" class="hl-value">"${myproj.classes.dir}"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;delete</strong> <span style="color: blue" class="hl-attribute">quiet</span>=<span style="color: green" class="hl-value">"true"</span> <span style="color: blue" class="hl-attribute">dir</span>=<span style="color: green" class="hl-value">"${generated.src.dir}"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;/target&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;target</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"generate-myproj-mithra-classes"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;taskdef</strong>   <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"mithra-gen"</span>
                    <span style="color: blue" class="hl-attribute">classname</span>=<span style="color: green" class="hl-value">"com.gs.fw.common.mithra.generator.MithraGenerator"</span>
                    <span style="color: blue" class="hl-attribute">loaderRef</span>=<span style="color: green" class="hl-value">"mithraGenerator"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
              <strong style="color: navy" class="hl-tag">&lt;classpath</strong> <span style="color: blue" class="hl-attribute">refid</span>=<span style="color: green" class="hl-value">"mithragen.classpath"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;/taskdef&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;mithra-gen</strong>   <span style="color: blue" class="hl-attribute">xml</span>=<span style="color: green" class="hl-value">"${myproj.home}/xml/mithra/MithraClassList.xml"</span>
                                <span style="color: blue" class="hl-attribute">generatedDir</span>=<span style="color: green" class="hl-value">"${generated.src.dir}"</span>
                                <span style="color: blue" class="hl-attribute">nonGeneratedDir</span>=<span style="color: green" class="hl-value">"${myproj.source.dir}"</span>
                                <span style="color: blue" class="hl-attribute">generateConcreteClasses</span>=<span style="color: green" class="hl-value">"true"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;/target&gt;</strong>

    <strong style="color: navy" class="hl-tag">&lt;target</strong> <span style="color: blue" class="hl-attribute">name</span>=<span style="color: green" class="hl-value">"compile-myproj"</span>
               <span style="color: blue" class="hl-attribute">depends</span>=<span style="color: green" class="hl-value">"clean-myproj, init-myproj, generate-myproj-mithra-classes"</span>
               <span style="color: blue" class="hl-attribute">description</span>=<span style="color: green" class="hl-value">"Compile my project  classes"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;javac</strong> <span style="color: blue" class="hl-attribute">destdir</span>=<span style="color: green" class="hl-value">"${myproj.classes.dir}"</span><strong style="color: navy" class="hl-tag">&gt;</strong>
            <strong style="color: navy" class="hl-tag">&lt;src</strong> <span style="color: blue" class="hl-attribute">path</span>=<span style="color: green" class="hl-value">"${myproj.source.dir}"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
            <strong style="color: navy" class="hl-tag">&lt;src</strong> <span style="color: blue" class="hl-attribute">path</span>=<span style="color: green" class="hl-value">"${generated.src.dir}"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
            <strong style="color: navy" class="hl-tag">&lt;classpath</strong> <span style="color: blue" class="hl-attribute">refid</span>=<span style="color: green" class="hl-value">"myproj.compile.classpath"</span><strong style="color: navy" class="hl-tag">/&gt;</strong>
        <strong style="color: navy" class="hl-tag">&lt;/javac&gt;</strong>
    <strong style="color: navy" class="hl-tag">&lt;/target&gt;</strong>
<strong style="color: navy" class="hl-tag">&lt;/project&gt;</strong></pre>
    </div>

</div></body></html>